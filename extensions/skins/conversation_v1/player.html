<script type="text/ng-template" id="skins/Conversation">
  <link rel="stylesheet" type="text/css"
        href="/extensions/skins/conversation_v1/static/conversation.css">

  <!-- Off-screen preview of future card in order to pre-determine the target height for the animation. -->
  <md-card class="conversation-skin-card" style="position: absolute; left: -30000px; top: -30000px;">
    <div id="futurePreview">
      <div class="conversation-skin-card-top-section">
        <img class="conversation-skin-initial-oppia-avatar" src="/images/general/o_black_72px.png">
        <div class="protractor-test-conversation-content" angular-html-bind="upcomingContentHtml">
        </div>
      </div>

      <div ng-if="interactionIsInline">
        <div class="conversation-skin-inline-interaction">
          <img class="conversation-skin-user-avatar img-circle" ng-src="<[profilePicture]>">
          <div class="protractor-test-conversation-input" angular-html-bind="upcomingInteractionHtml">
          </div>
        </div>
      </div>
    </div>
  </md-card>

  <!-- TODO(sll): do we need to preserve the itemprop attr? -->
  <div role="main" style="margin: 0 auto; position: relative;">
    <progress-dots num-dots="numProgressDots" current-dot-index="currentProgressDotIndex">
    </progress-dots>

    <md-card class="conversation-skin-card conversation-skin-animate-card" ng-class="{'animate-move-tutor-card-left': !interactionIsInline}">
      <div class="conversation-skin-card-feedback-toggle-container" ng-if="activeCard.stateName && !isInPreviewMode">
        <span class="glyphicon glyphicon-comment conversation-skin-card-feedback-toggle"
              popover-placement="<[isWindowNarrow() ? 'left' : 'bottom']>"
              popover-template="popover/feedback" popover-trigger="click"
              tooltip="Feedback" tooltip-placement="bottom"
              state-name="<[activeCard.stateName]>">
        </span>
      </div>

      <div class="conversation-skin-animate-card-contents" ng-class="{'animate-card-change': startCardChangeAnimation}">
        <div class="conversation-skin-card-top-section">
          <img class="conversation-skin-initial-oppia-avatar" src="/images/general/o_black_72px.png">
          <div class="protractor-test-conversation-content" angular-html-bind="activeCard.content">
          </div>
        </div>

        <div class="conversation-skin-card-middle-section" ng-if="arePreviousResponsesShown">
          <div ng-repeat="responsePair in activeCard.answerFeedbackPairs track by $index">
            <div ng-if="!$last">
              <answer-feedback-pair profile-picture="profilePicture"
                                    answer="responsePair.learnerAnswer"
                                    feedback="responsePair.oppiaFeedback">
              </answer-feedback-pair>
            </div>
          </div>
        </div>
        <div ng-if="!arePreviousResponsesShown && activeCard.answerFeedbackPairs.length > 1">
          <h4 class="conversation-skin-responses-dropdown-container" ng-click="showPreviousResponses()">
            <span class="conversation-skin-responses-dropdown-text">
              <[activeCard.answerFeedbackPairs.length - 1]> prior response<span ng-if="activeCard.answerFeedbackPairs.length > 2">s</span>
              <span class="glyphicon glyphicon-play" style="font-size:10px; margin-bottom: -4px;"></span>
            </span>
          </h4>
        </div>

        <!-- Always show the most recent response pair, if there is one. -->
        <div class="conversation-skin-card-bottom-section" ng-if="activeCard.answerFeedbackPairs.length > 0">
          <answer-feedback-pair profile-picture="profilePicture"
                                answer="activeCard.answerFeedbackPairs[activeCard.answerFeedbackPairs.length - 1].learnerAnswer"
                                feedback="activeCard.answerFeedbackPairs[activeCard.answerFeedbackPairs.length - 1].oppiaFeedback">
          </answer-feedback-pair>
        </div>

        <div ng-if="!waitingForOppiaFeedback && (interactionIsInline || upcomingContentHtml) && currentProgressDotIndex === transcript.length - 1">
          <div class="conversation-skin-inline-interaction">
            <img class="conversation-skin-user-avatar img-circle" ng-src="<[profilePicture]>">
            <div ng-if="upcomingContentHtml">
              <md-button class="md-button-success" ng-click="showPendingCard()">Continue</md-button>
            </div>
            <div ng-if="!upcomingContentHtml">
              <div class="protractor-test-conversation-input" angular-html-bind="interactionHtml">
              </div>
            </div>
          </div>
        </div>
      </div>
    </md-card>

    <div ng-if="!interactionIsInline && interactionHtml && (!finished || !isIframed)" class="conversation-skin-supplemental-interaction">
      <md-card class="conversation-skin-supplemental-card">
        <div class="protractor-test-conversation-input" angular-html-bind="interactionHtml">
        </div>
      </md-card>
    </div>
  </div>

  <div ng-if="finished && isLoggedIn && !isInPreviewMode && !isIframed" class="conversation-skin-final-ratings">
    <oppia-gadget-panel panel-contents="gadgetPanelsContents.main" class="conversation-skin-main-gadget-panel"></oppia-gadget-panel>

    <div style="margin-bottom: 20px;">Learned something new? How would you rate this exploration?</div>
    <div popover-placement="bottom" popover-template="popover/feedback" popover-trigger="click">
      <rating-from-value rating-value="userRating" is-editable="true" on-edit="submitUserRating" style="letter-spacing: 10px;">
      </rating-from-value>
    </div>
  </div>
</script>

<script type="text/ng-template" id="components/answerFeedbackPair">
  <div class="conversation-skin-learner-answer-container">
    <img class="conversation-skin-user-avatar" ng-src="<[profilePicture()]>">
    <div class="conversation-skin-learner-answer" angular-html-bind="answer()">
    </div>
  </div>

  <div class="conversation-skin-oppia-feedback-container">
    <img class="conversation-skin-oppia-avatar img-circle" ng-src="/images/general/o_black_72px.png">

    <div class="conversation-skin-oppia-feedback protractor-test-conversation-feedback">
      <div ng-if="feedback() === null">
        <div class="conversation-skin-feedback-dot-one"></div>
        <div class="conversation-skin-feedback-dot-two"></div>
        <div class="conversation-skin-feedback-dot-three"></div>
      </div>
      <div ng-if="feedback() !== null" angular-html-bind="feedback()"></div>
    </div>
  </div>
</script>

<script type="text/ng-template" id="components/progressDots">
  <style>
    @keyframes oppia-animate-enter-progress-dot {
      0% {
        margin-left: -10px;
      }

      100% {
        margin-left: 0;
      }
    }

    .oppia-progress-dot {
      border-radius: 50%;
      box-shadow: 0px 2px 5px 0 rgba(0, 0, 0, 0.26);
      float: left;
      margin-left: 10px;
    }
    .oppia-progress-dot-active {
      background-color: #fff;
      height: 10px;
      width: 10px;
    }
    .oppia-progress-dot-inactive {
      background-color: #ccc;
      cursor: pointer;
      height: 10px;
      width: 10px;
    }

    .oppia-progress-dot-list {
      list-style-type: none;
      margin: 10px auto;
      padding-left: 0;
      position: relative;
      text-align: center;
    }

    .oppia-animate-progress-dot {
      display: inline-block;
    }
    .oppia-animate-progress-dot.ng-enter {
      -webkit-animation: 400ms oppia-animate-enter-progress-dot;
      animation: 400ms oppia-animate-enter-progress-dot;
      -webkit-animation-timing-function: linear;
      animation-timing-function: linear;
    }
  </style>

  <div style="margin: 12px auto;">
    <div style="width: 300px; margin: 10px auto;">
      <ul class="oppia-progress-dot-list">
        <li ng-repeat="dot in dots track by $index" class="oppia-animate-progress-dot">
          <span class="oppia-progress-dot oppia-progress-dot-active"
                ng-if="$index === currentDotIndex" ng-show="dots.length > 1">
          </span>
          <span class="oppia-progress-dot oppia-progress-dot-inactive"
                ng-if="$index !== currentDotIndex"
                ng-click="changeActiveDot($index)">
          </span>
        </li>
      </ul>
    </div>
  </div>
</script>
